[load std.wuns]

[defmacro alloc [mem-name type]
  [flist [quote cast]
    [flist [quote pointer] [flist [quote exp] mem-name] type]
    [flist [quote alloc-n] [flist [quote size-of] type]]]]

[defmacro static-word-to-u8-vector [fw]
  [let [w [form-to-word fw]
        s [word-byte-size w]
        gl [growable-list]]
    [push gl [quote array]]
    [push gl [quote [u8]]]
    [loop [i 0]
      [when [lt-s i s]
        [push gl [flist [quote u8] [form/word [int-to-word [char-code-at w i]]]]]
        [continue i [inc i]]]]
    [flist [quote record]
      [quote size] [flist [quote i32] [form/word [int-to-word s]]]
      [quote array] [form/list [clone-growable-to-frozen-list gl]]]]]
